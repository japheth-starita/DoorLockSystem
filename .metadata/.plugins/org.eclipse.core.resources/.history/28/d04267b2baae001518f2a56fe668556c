package com.example.doorlocksystem;

import android.app.Activity;
import android.bluetooth.BluetoothAdapter;
import android.bluetooth.BluetoothDevice;
import android.content.Intent;
import android.os.Bundle;
import android.os.Handler;
import android.os.Message;
import android.util.Log;
import android.view.View;
import android.widget.AdapterView;
import android.widget.ArrayAdapter;
import android.widget.ListView;
import android.widget.Toast;
import android.widget.AdapterView.OnItemClickListener;

public class DeleteDeviceActivity extends Activity {

	private ListView listofdevices;
	private BluetoothAdapter mBluetoothAdapter;
	private ConnectToDevice mConnectThread;
	private BluetoothDevice btModule;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_delete_device);
		
		listofdevices = (ListView) findViewById(R.id.listofdevices);
		ArrayAdapter<String> optionArrayAdapter = new ArrayAdapter<String>(this, android.R.layout.simple_list_item_1);
        listofdevices.setAdapter(optionArrayAdapter);
		
        listofdevices.setOnItemClickListener(new OnItemClickListener() {
			@Override
			public void onItemClick(AdapterView<?> parent, View view,
					int position, long id) {
			}
        }); 

	}
	
	 public Handler mHandler2 = new Handler() {
		  public void handleMessage(Message msg) {
			  String data = (String) msg.obj;
			  Log.d("Hello",(data.length()%17 < 1)+"");
			  if(data.equals("OK")){
				  //Get list of mac addresses
				  mConnectThread.sendData(SignalToArduino.SEND_ANDROID_MAC_ADD+"");
				  Log.d("BT", "Sending data");
			  }
			  else {
				  data = data.trim();
				  if(data.length()/17 >= 3){
					  Log.d("Error", "Adding Device");
					  Toast.makeText(getApplicationContext(), ErrorCode.E40, Toast.LENGTH_LONG).show();
					  addOwnDevice.removeDialog();
					  closeAll();
				  }
				  else{
					  Log.d("Success", "Adding Device");
					  data+=mBluetoothAdapter.getAddress();
					  Log.d("Addresses", data);
					  mConnectThread.sendData(SignalToArduino.SEND_DEVICE_TO_ADD+data);
					  Log.d("BT", "Sending data");
					  addOwnDevice.removeDialog();
					  Toast.makeText(DeviceManagerActivity.this, "Successfully Added Device", Toast.LENGTH_SHORT).show();
					  closeAll();
				  }
			  }
		}
	  };
	  
	  public void closeAll(){
		  try{
			  mBluetoothAdapter.disable();
			}catch(Exception e){}		
	  }

}
